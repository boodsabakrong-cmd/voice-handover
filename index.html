<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏£‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .recording-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .recording-button.recording {
            animation: pulse-red 1.5s infinite;
            background-color: #ef4444; /* Red 500 */
        }
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .file-list {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 1rem;
        }
        .audio-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .audio-item:last-child {
            border-bottom: none;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">

    <div class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h1 class="text-2xl font-bold text-center text-blue-800 mb-6">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h1>
        <p class="text-xs text-red-500 text-center mb-4 font-semibold">
            üîê **‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: PASS999** (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ) üîê
        </p>

        <div class="space-y-4">

            <!-- 1. Metadata Inputs -->
            <div class="space-y-2">
                <label for="senderName" class="block text-sm font-medium text-gray-700">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏£:</label>
                <input type="text" id="senderName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô.‡∏™. ‡∏≠‡∏£‡∏∏‡∏ì‡∏£‡∏±‡∏ï‡∏ô‡πå (‡∏ä)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                
                <label for="receiverName" class="block text-sm font-medium text-gray-700 pt-2">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏£:</label>
                <input type="text" id="receiverName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô.‡∏™. ‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏†‡∏≤ (‡∏ö)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                
                <label for="shiftType" class="block text-sm font-medium text-gray-700 pt-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ß‡∏£:</label>
                <select id="shiftType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <option value="‡πÄ‡∏ä‡πâ‡∏≤ -> ‡∏ö‡πà‡∏≤‡∏¢">‡πÄ‡∏ä‡πâ‡∏≤ ‚Üí ‡∏ö‡πà‡∏≤‡∏¢</option>
                    <option value="‡∏ö‡πà‡∏≤‡∏¢ -> ‡∏î‡∏∂‡∏Å">‡∏ö‡πà‡∏≤‡∏¢ ‚Üí ‡∏î‡∏∂‡∏Å</option>
                    <option value="‡∏î‡∏∂‡∏Å -> ‡πÄ‡∏ä‡πâ‡∏≤">‡∏î‡∏∂‡∏Å ‚Üí ‡πÄ‡∏ä‡πâ‡∏≤</option>
                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
            </div>
            
            <!-- UPDATED: Password Input with default value -->
            <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                <label for="reportPassword" class="block text-sm font-medium text-yellow-800">üîí ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ:</label>
                <input type="text" id="reportPassword" value="PASS999" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234 (‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°)" class="w-full p-3 border border-yellow-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 text-sm mt-1">
                <p class="text-xs text-yellow-700 mt-1">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ</p>
            </div>

            <hr class="my-4">

            <!-- 2. Voice Recording Section -->
            <div class="text-center bg-blue-50 p-4 rounded-lg">
                <p class="text-lg font-semibold text-blue-800 mb-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏õ (Segment)</p>
                
                <label for="patientBed" class="block text-sm font-medium text-gray-700 pt-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</label>
                <input type="text" id="patientBed" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12/1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-3">

                <label for="patientName" class="block text-sm font-medium text-gray-700 pt-2 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</label>
                <input type="text" id="patientName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏£‡∏±‡∏Å‡∏ä‡∏≤‡∏ï‡∏¥" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-4">
                
                <button id="recordBtn" class="recording-button bg-red-500 text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto text-sm font-bold shadow-xl">
                    <span id="recordStatus">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                </button>
                <div id="recordingTimer" class="mt-2 text-gray-600">00:00</div>
                <div id="audioStatus" class="mt-3 text-sm font-medium text-gray-500"></div>
                
                <button id="saveClipBtn" class="mt-4 w-full py-2 bg-yellow-500 text-white font-bold rounded-lg shadow-md hover:bg-yellow-600 transition duration-150 disabled:opacity-50" disabled>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
                </button>
            </div>
            
            <!-- 3. Recorded Clips List -->
            <div id="clipsContainer" class="file-list mt-4 hidden">
                <p class="font-semibold text-gray-700 mb-2">üíæ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏õ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ:</p>
                <div id="clipsList" class="space-y-2">
                    <!-- Audio clips will be inserted here -->
                </div>
            </div>

            <!-- 4. LINE API Setup (Set as Read-only with Placeholders) -->
            <hr class="my-4">
            <div class="space-y-2">
                <label for="lineAccessToken" class="block text-sm font-medium text-gray-700">Channel Access Token:</label>
                <input type="text" id="lineAccessToken" 
                       value="7jDpt+d4TOw6B/PaXRV7UmbENXHkAU+6NEcuMeTm1tM6eva8H2wb62zY+iRJqPiAiYh96YbhmPe9wFG+3AKBceZqgfV9u4DOrlrtKnldI0iTRKGb3vxLD8HnZ09xMPT2rzol1unMgDA6ipWe2w0bnwdB04t89/1O/w1cDnyilFU=" 
                       placeholder="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Token ‡∏Ç‡∏≠‡∏á LINE Bot (Messaging API)" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-gray-600 bg-gray-50 text-xs" readonly>
                
                <label for="lineRecipientId" class="block text-sm font-medium text-gray-700 pt-2">Group ID ‡∏´‡∏£‡∏∑‡∏≠ User ID ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</label>
                <input type="text" id="lineRecipientId" 
                       value="Cf52a26d2a2455bf0c79cdd08bca70d87" 
                       placeholder="‡πÄ‡∏ä‡πà‡∏ô Cxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-gray-600 bg-gray-50 text-xs" readonly>
                <p class="text-xs text-gray-500 mt-1">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠ Group ID ‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏£</p>
            </div>

            <!-- 5. Send Button -->
            <button id="sendBtn" class="w-full py-3 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 transition duration-150 disabled:opacity-50" disabled>
                ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏¥‡∏õ)
            </button>
            <div id="messageBox" class="mt-3 p-3 text-center rounded-lg text-sm hidden"></div>
        </div>
    </div>

    <!-- Edit Clip Modal -->
    <div id="editModal" class="modal fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm transform transition duration-300 translate-y-10">
            <h2 class="text-xl font-bold text-blue-700 mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏¥‡∏õ</h2>
            <p id="modalClipName" class="text-md font-semibold text-gray-600 mb-3"></p>
            
            <label for="modalBed" class="block text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</label>
            <input type="text" id="modalBed" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-3">
            
            <label for="modalName" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</label>
            <input type="text" id="modalName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-4">
            
            <div class="flex justify-end space-x-3">
                <button id="closeModalBtn" class="py-2 px-4 bg-gray-300 text-gray-800 font-bold rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="saveModalBtn" class="py-2 px-4 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        const recordBtn = document.getElementById('recordBtn');
        const recordStatus = document.getElementById('recordStatus');
        const recordingTimer = document.getElementById('recordingTimer');
        const audioStatus = document.getElementById('audioStatus');
        const saveClipBtn = document.getElementById('saveClipBtn');
        const sendBtn = document.getElementById('sendBtn');
        const senderNameInput = document.getElementById('senderName');
        const receiverNameInput = document.getElementById('receiverName');
        const shiftTypeInput = document.getElementById('shiftType');
        const patientBedInput = document.getElementById('patientBed'); 
        const patientNameInput = document.getElementById('patientName'); 
        const reportPasswordInput = document.getElementById('reportPassword'); 
        const lineAccessTokenInput = document.getElementById('lineAccessToken');
        const lineRecipientIdInput = document.getElementById('lineRecipientId');
        const clipsContainer = document.getElementById('clipsContainer');
        const clipsList = document.getElementById('clipsList');
        const messageBox = document.getElementById('messageBox');
        
        // Modal Elements
        const editModal = document.getElementById('editModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const saveModalBtn = document.getElementById('saveModalBtn');
        const modalClipName = document.getElementById('modalClipName');
        const modalBedInput = document.getElementById('modalBed');
        const modalNameInput = document.getElementById('modalName');

        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime;
        let timerInterval;
        let recordedClips = []; 
        let currentBlob = null; 
        let currentEditIndex = null; 

        // IMPORTANT: In a real environment, this URL would be generated after uploading the audio file 
        // to a storage service (like Google Cloud Storage or Firebase Storage).
        const SIMULATED_FILE_BASE_URL = 'https://storage.google.com/handoff-voice/clip-';

        // --- Utility Functions ---
        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {